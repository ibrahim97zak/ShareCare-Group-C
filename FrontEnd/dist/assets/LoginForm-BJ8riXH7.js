import{u as b,a as f,r as o,j as e,L as v,b as w}from"./index-D5AkeCjx.js";import{J as m,I as y}from"./joi-browser.min-Cvr9FY0I.js";import{P as E}from"./PasswordInput-Z_491d3r.js";import{a as N}from"./axios-CCb-kr4I.js";import"./iconBase-D6RYXLqu.js";const L=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(?:\.[a-zA-Z]{2,})?$/,I=l=>m.object({email:m.string().pattern(L).required().messages({"string.empty":"Email is required","string.pattern.base":"Please enter a valid email"}),password:m.string().min(6).required().messages({"string.empty":"Password is required","string.min":"Password must be at least 6 characters long"})}).validate(l,{abortEarly:!1}),A="http://localhost:5000",Z=()=>{const{setIsLoggedIn:l,setUser:d,user:S,isLoggedIn:k}=b(),g=f(),[i,p]=o.useState({email:"",password:""}),[u,c]=o.useState(null),[t,h]=o.useState({email:"",password:""});o.useEffect(()=>{Object.keys(t).every(a=>t[a]==="")&&c(null)},[t]);const j=async a=>{a.preventDefault();const x={...i};try{const{error:n}=I(x);if(n){const s={};n.details.forEach(r=>{s[r.path[0]]?s[r.path[0]].push(r.message):s[r.path[0]]=[r.message]}),h(s)}else try{const s=await N.post(`${A}/api/auth/login`,x,{withCredentials:!0});if(s.status===200){const r=s.data.token;w.set("token",r,{expires:1,secure:!0,sameSite:"Lax"}),await d(s.data.user),l(!0),g("/")}}catch(s){c(s.response.data.error)}}catch(n){c(n.message)}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center justify-center mt-28",children:e.jsx("div",{className:"w-96 border rounded bg-white px-7 py-10",children:e.jsxs("form",{onSubmit:j,children:[e.jsx("h4",{className:"text-2xl text-center mb-7",children:"Login in SAHEM"}),e.jsx("br",{}),e.jsx(y,{type:"email",placeholder:"Email",value:i.email,onChange:a=>p({...i,email:a.target.value})}),t.email&&e.jsx("p",{className:"text-red-600 text-xs pb-1",children:t.email}),e.jsx("br",{}),e.jsx(E,{value:i.password,onChange:a=>p({...i,password:a.target.value})}),t.password&&e.jsx("p",{className:"text-red-600 text-xs pb-1",children:t.password}),e.jsx("br",{}),u&&e.jsx("p",{className:"text-red-600 text-xs pb-1",children:u}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Login"}),e.jsxs("p",{className:"text-sm text-center mt-4",children:["Not registered yet?"," ",e.jsx(v,{to:"/signup",className:"font-medium text-primary underline",children:"Create an Account"})]})]})})})})};export{A as ApiUrl,Z as default};

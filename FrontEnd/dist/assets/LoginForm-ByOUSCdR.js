import{b as v,u as y,r as l,j as e,L as E,a as N,c as L}from"./index-BMzkFxf0.js";import{J as m,I}from"./joi-browser.min-d-eAp7Jt.js";import{P as A}from"./PasswordInput-D1ypZIOJ.js";import"./iconBase-Cy7qzL8i.js";const P=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(?:\.[a-zA-Z]{2,})?$/,S=d=>m.object({email:m.string().pattern(P).required().messages({"string.empty":"Email is required","string.pattern.base":"Please enter a valid email"}),password:m.string().min(6).required().messages({"string.empty":"Password is required","string.min":"Password must be at least 6 characters long"})}).validate(d,{abortEarly:!1}),Z=()=>{const{setIsLoggedIn:d,setUser:u}=v(),g=y(),[n,p]=l.useState({email:"",password:""}),[x,c]=l.useState(null),[r,h]=l.useState({email:"",password:""});l.useEffect(()=>{Object.keys(r).every(s=>r[s]==="")&&c(null)},[r]);const f=s=>{const{error:o}=S(s);if(o){const i={};return o.details.forEach(t=>{i[t.path[0]]?i[t.path[0]].push(t.message):i[t.path[0]]=[t.message]}),h(i),!1}return!0},j=async s=>{var i,t;s.preventDefault();const o={...n};if(f(o))try{const a=await N.post("/api/auth/login",o,{withCredentials:!0});if(a.status===200){const w=a.data.token;L.set("token",w,{expires:1,secure:!0,sameSite:"Lax"});const{password:k,...b}=a.data.user;await u(b),a.data.user&&a.data.user.role?(d(!0),g("/")):c("User role is undefined.")}}catch(a){c(((t=(i=a.response)==null?void 0:i.data)==null?void 0:t.error)||a.message)}};return e.jsx("div",{className:"flex items-center justify-center mt-28",children:e.jsx("div",{className:"w-96 border rounded bg-white px-7 py-10",children:e.jsxs("form",{onSubmit:j,children:[e.jsx("h4",{className:"text-2xl text-center mb-7",children:"Login in SAHEM"}),e.jsx(I,{type:"email",placeholder:"Email",value:n.email,onChange:s=>p({...n,email:s.target.value})}),r.email&&e.jsx("p",{className:"text-red-600 text-xs pb-1",children:r.email}),e.jsx(A,{value:n.password,onChange:s=>p({...n,password:s.target.value})}),r.password&&e.jsx("p",{className:"text-red-600 text-xs pb-1",children:r.password}),x&&e.jsx("p",{className:"text-red-600 text-xs pb-1",children:x}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Login"}),e.jsxs("p",{className:"text-sm text-center mt-4",children:["Not registered yet? ",e.jsx(E,{to:"/register",className:"font-medium text-primary underline",children:"Create an Account"})]})]})})})};export{Z as default};
